# Общение с персонами (Chat)

Независимый модуль для интерактива с готовыми персонами из БД `synthetic_v2/db/personas.sqlite`.
Не зависит от пайплайна подготовки (использует только результаты — БД и .env).

Инструменты:
- `synthetic_v2/chat/talk.py` — отбор по тегам/поиску и чат/батч-вопросы

Запуск:
```
python synthetic_v2/chat/talk.py
```

Требования:
- `synthetic_v2/.env` с `LLM_PROVIDER`, `LLM_MODEL` и ключами API
- Заполненная БД `synthetic_v2/db/personas.sqlite` из пайплайна подготовки


Сценарии в меню:
- 1) Чат с одной персоной — ручной выбор по тегам/фильтрам.
- 2) Батч‑вопрос по выборке персон — задаёт один вопрос сразу нескольким выбранным персонам.
- 3) Батч‑вопрос по пресету — использует ранее сохранённые критерии.
- 4) По описанию — выбрать персону(ы) и чат — вводите описание естественным языком (например: «пользователь нейросетей в декрете», «Екатерина из Екатеринбурга»). Сначала используется FTS‑поиск по БД и LLM‑переренжирование. Если FTS не нашёл никого, включается фолбэк: LLM сопоставляет описание с тегами таксономии и альтернативными формулировками, затем выполняется поиск по тегам/расширенный FTS и финальный переренжирующий проход LLM. Можно выбрать произвольное подмножество предложенных персон и вести диалог с ними.

Примечания:
- Перед обращениями к LLM выполняется короткая проверка `preflight_check`, выводится краткий отчёт.
- В новых LLM‑вызовах ограничения на количество токенов не задаются (следуем правилам проекта).
- Логи сохраняются в `synthetic_v2/runs/chats/…`: для каждой персоны отдельный файл чата; для мульти‑диалога — сводный файл в подпапке `multi_YYYYmmdd_HHMMSS`.

